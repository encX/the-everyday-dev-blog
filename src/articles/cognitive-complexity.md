---
title: "Cognitive complexity"  
headliner: "เมื่อการอ่าน code ของคนอื่นเป็นเรื่องจำเป็น"  
featured: true  
featuredImage: ../images/cognitive-complexity-feature.png 
path: "/cognitive-complexity"  
date: "2019-12-16"  
tags: ["code-quality", "programming"]
---

# Cognitive complexity
## เมื่อการอ่าน code ของคนอื่นเป็นเรื่องจำเป็น

สำหรับหลายๆคน อาจฟังดูเหมือนเรื่องไม่ใหญ่โตอะไร 
แต่สำหรับคนที่ต้องทำงานกับระบบที่คน contribute เยอะๆ
ทำงานกับบริษัทใหญ่ที่มี culture ให้ทุกคนสามารถแก้ไขระบบของทีมอื่นได้
หรือ เป็นทีมเจ้าของระบบที่ต้อง review code ของคนอื่นเป็นประจำ
หรือ contribute project open source ต่างๆ
อาจจะประสบพบเจอกับ code จากคนมากหน้าหลายตารวมอยู่ใน project เดียวกัน
ซึ่งแน่นอนว่าทุกคนก็อาจจะไม่ได้ใช้ practice ที่ดีในการแก้ปัญหา
หรือเขียน code ที่ใช้วิธีต่างๆได้ถูกต้อง แต่ code กลับอ่านและเข้าใจยาก

ย้อนกลับไปในยุคที่การทำ software เริ่มมแพร่หลาย การเขียน code และ test นั้นเริ่มเป็นสิ่งที่ทุกคนควรทำ
แต่การเขียน test อาจจะไม่มีประสิทธิ์ภาพ
บางครั้งต้องเขียน test case ในปริมาณที่ "มากเกินไป" ถึงจะครอบคลุมการทำงานทั้งหมด
จึงทำให้คนเริ่มสร้างมาตรฐานในการวัดความซับซ้อนของโปรแกรมขึ้นมา
หนึ่งในนั้นคือ "Cyclomatic complexity" ที่สร้างขึ้นเมื่อปี 1976

Cyclomatic complexity สร้างขึ้นด้วยไอเดียการมอง flow ของโปรแกรมเป็น graph
แล้วพิจารณาจำนวน node และ edge ที่เกิดขึ้นและคำนวนเป็นแต้ม ซึ่งใช้บอกจำนวนของ test case อย่างต่ำ
ที่ต้องเขียนเพื่อให้ test case ครอบคลุมทุก branch (ทางแยกในโปรแกรม เช่น if/loop/try-catch) ในฟังก์ชั่นนั้นๆ

// insert sample functions with low amd high cyclomatic complexity and briefly describe those

ในยุคหลังมา การทำ software ร่วมกันกลายเป็นเรื่องปกติและแพร่หลาย โดยเฉพาะในโลกของ Open source
ซึ่งการเขียน code ให้ไม่ซับซ้อนมากจนเกินไปเป็นเรื่องสำคัญ เพราะจะทำให้คนที่ไม่เคยอ่าน code ชุดนั้นมาก่อน
ใช้เวลาเข้าใจได้ง่ายและรวดเร็วขึ้น และทำงานได้มีประสิทธิภาพมากขึ้น จึงมีคนนำ Cyclomatic complexity
มาเป็นตัวบ่งชี้ว่า ฟังก์ชั่นใดๆในโปรแกรมมีความซับซ้อนมากเกินไปหรือไม่ 
ถ้ามีมากเกินไปก็จะเป็นสัญญาณให้เจ้าของ code ทำการ "refactor" code นั้นด้วยวิธีต่างๆ
ให้โปรแกรมมีความซับซ้อนน้อยลง จนกลายเป็นเรื่องปกติที่ทุกคนใช้เป็นมาตรฐาน

แต่ตัว Cyclomatic complexity นี้ยังมีปัญหาบางอย่างที่แก้ไม่ได้
นั่นคือเรื่อง "ความอ่านง่ายของ code"
ลอง พิจารณาฟังก์ชั่นนี้ 

// insert function with low cyclomatic complexity but terrible reading

จะสังเกตได้ว่า code มีแต้ม Cyclomatic ค่อนข้างน้อย เนื่องจากแทบไม่มีทางแยกใน code เลย
แต่การอ่านเพื่อให้เข้าใจว่าฟังก์ชั่นนี้ทำอะไรได้ค่อนข้างลำบาก
